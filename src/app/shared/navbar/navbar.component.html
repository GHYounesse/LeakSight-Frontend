

<nav class="navbar navbar-expand-lg navbar-dark fixed-top" >
  <div class="container-fluid">
    <!-- Brand -->
    <a class="navbar-brand" [routerLink]="(isLoggedIn$ | async) ? ['/dashboard'] : ['/home']">
      <img src="logo.png" width="200" height="65" alt="LeakSight">
    </a>

    <!-- Mobile Toggle -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      (click)="toggleNavbar()"
      [attr.aria-expanded]="isNavbarOpen"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navigation -->
    <div
      class="collapse navbar-collapse"
      id="navbarNav"
      [class.show]="isNavbarOpen"
    >
      <!-- Main Navigation - Only show if items are available -->
      <ul class="navbar-nav me-auto" *ngIf="getVisibleNavItems().length > 0">
        <li
          *ngFor="let item of getVisibleNavItems()"
          class="nav-item"
          [class.dropdown]="item.children && item.children.length > 0"
        >
          <!-- Items with children (dropdown) -->
          <ng-container *ngIf="item.children && item.children.length > 0; else singleItem">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              [class.active]="isParentActive(item)"

              (click)="$event.preventDefault()"
            >
              <i [class]="item.icon"></i>
              {{ item.label }} 
              <span
                *ngIf="item.badge && item.badge > 0"
                class="notification-badge"
              >
                {{ item.badge }}
              </span>
            </a>
            <ul class="dropdown-menu">
              <li *ngFor="let child of item.children">
                <a
                  class="dropdown-item"
                  [routerLink]="child.path"
                  routerLinkActive="active"
                  (click)="navigateTo(child.path)"
                >
                  <i [class]="child.icon"></i>
                  {{ child.label }}
                </a>
              </li>
            </ul>
          </ng-container>

          <!-- Single items -->
          <ng-template #singleItem>
            <a
              class="nav-link"
              [routerLink]="item.path"
              [routerLinkActive]="isActiveStr(item.path)"
              (click)="navigateTo(item.path)"
            >
              <i [class]="item.icon"></i>
              {{ item.label }} 
              <span
                *ngIf="item.badge && item.badge > 0"
                class="notification-badge"
              >
                {{ item.badge }}
              </span>
            </a>
          </ng-template>
        </li>
      </ul>

      
      
      <!-- User Section -->
      <ul class="navbar-nav ms-auto">
       
        

        <li class="nav-item dropdown" *ngIf="isUserLoggedIn">
  <a
    class="nav-link dropdown-toggle"
    href="#"
    role="button"
    data-bs-toggle="dropdown"
    (click)="$event.preventDefault()"
  >
    <div class="user-avatar">{{ userInitial }}</div>
    <span class="d-none d-md-inline">{{ username }}</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end">
    
    
    <!-- Existing Menu Items -->
    <li *ngFor="let menuItem of getVisibleUserMenuItems()">
      <a
        class="dropdown-item"
        [routerLink]="menuItem.path"
        (click)="navigateTo(menuItem.path)"
      >
        <i [class]="menuItem.icon"></i>
        {{ menuItem.label }}
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <a
        class="dropdown-item"
        href="#"
        (click)="logout($event)"
      >
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </a>
    </li>
  </ul>
</li>

        <!-- Login Link - Only show if not logged in -->
        <li class="nav-item" *ngIf="!isUserLoggedIn && !isLoginPage()">
          <a class="nav-link" [routerLink]="['/login']">
            <i class="fas fa-sign-in-alt"></i>
            Login 
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
